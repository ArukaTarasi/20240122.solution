@{
    ViewData["Title"] = "Spots";
}

<h1>Spots</h1>
<div class="row mb-3">
    <div class="col-3"></div>
    <div class="col-6"></div>
    <div class="col-3">
        <input type="search" id="inputKeyword" class="form-control" placeholder="景點搜尋" />
    </div>
</div>
<div class="row row-cols-1 row-cols-md-3 g-4" id="spots">

</div>
@section Scripts
{
    <script>
        const searchData =
        {
            "categoryId": 0,
            "keyword": "北投",
            // "keyword": "北投",
            "page": 1,
            "pageSize": 9,
            "sortType": "asc",
            "sortBy": ""
        };
        const divSpots = document.querySelector('#spots');
        const inputKeyword = document.querySelector('#inputKeyword');

        //根據 searchData 條件，讀取景點資料
        const loadSpots = async () => {
            const response = await fetch('@Url.Content("~/api/spots")',
                {
                    method: "POST",
                    body: JSON.stringify(searchData),
                    headers: {
                        "Content-Type": "application/json"
                    }
                });
            const datas = await response.json();
            const cardSpots = datas.spotsResult.map(spot => {
                const { spotId, spotTitle, spotDescription, spotImage, address } = spot;
                return (
                    `
                    <div class="card" style="width: 18rem;">
                        <img class="card-img-top" src="${spotImage}" alt="${spotTitle}">
                        <div class="card-body">
                            <h5 class="card-title">${spotId} - ${spotTitle}</h5>
                            <p class="card-text">${spotDescription.length <= 100 ? spotDescription : spotDescription.substring(0, 100)}...</p>
                            <a href="#" class="btn btn-primary">${address}</a>
                        </div>
                    </div>
                    `
                )
            });
            divSpots.innerHTML = cardSpots.join("");
        }
        inputKeyword.addEventListener('keydown', event => {
            if (event.which === 13) {
                searchData.keyword = event.target.value;
                searchData.page = 1;
                loadSpots();
            }
        })
        // 載入景點
        loadSpots();
    </script>
}
